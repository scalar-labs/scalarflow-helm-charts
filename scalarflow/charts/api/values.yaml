# Default values for scalarflow-api.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

api:
  replicaCount: 1
  image:
    repository: ghcr.io/scalar-labs/scalarflow-api
    pullPolicy: IfNotPresent
    tag: ""

  service:
    # -- Service type.
    type: ClusterIP
    # -- Service port.
    port: 8080
    # -- Container target port.
    targetPort: 8080
    # -- Protocol for the service.
    protocol: TCP
    # -- Service annotations.
    annotations: {}

  # Environment variables
  env:
    # -- Spring Datasource (ScalarDB)
    - name: SPRING__DATASOURCE__SCALARDB__HOST
      value: "scalardb-cluster"
    # -- Authentication
    - name: AUTHENTICATION__STATIC_JWT__SECRET
      valueFrom:
        secretKeyRef:
          name: scalarflow-api-secret
          key: jwt-secret
    # -- OAuth2 Google Provider
    - name: AUTHENTICATION__PROVIDERS__OAUTH2__GOOGLE__ENABLED
      value: "true"
    - name: AUTHENTICATION__PROVIDERS__OAUTH2__GOOGLE__REDIRECT_URI
      value: "https://scalarflow.example.com/oauth2/callback"
    - name: AUTHENTICATION__PROVIDERS__OAUTH2__GOOGLE__CLIENT_ID
      value: ""
    - name: AUTHENTICATION__PROVIDERS__OAUTH2__GOOGLE__CLIENT_SECRET
      valueFrom:
        secretKeyRef:
          name: scalarflow-api-secret
          key: google-oauth2-client-secret
    # -- App
    - name: APP__URL
      value: "https://scalarflow.example.com"
    # -- Email (SendGrid)
    - name: EMAIL__FROM
      value: "no-reply@scalarflow.example.com"
    - name: EMAIL__PROVIDER
      value: "SENDGRID"
    - name: EMAIL__SENDGRID__API_KEY
      valueFrom:
        secretKeyRef:
          name: scalarflow-api-secret
          key: sendgrid-api-key
    # -- Rollbar
    - name: ROLLBAR_ENABLED
      value: "true"
    - name: ROLLBAR_ACCESS_TOKEN
      valueFrom:
        secretKeyRef:
          name: scalarflow-api-secret
          key: rollbar-access-token
    - name: ROLLBAR_ENVIRONMENT
      value: "production"
    - name: ROLLBAR_CODE_VERSION
      value: ""
    # Admin user
    - name: APP__INITIAL_ADMIN_USER__ENABLED
      value: "false"
    - name: APP__INITIAL_ADMIN_USER__EMAIL
      value: "admin@scalarflow.example.com"
    - name: APP__INITIAL_ADMIN_USER__PASSWORD
      valueFrom:
        secretKeyRef:
          name: scalarflow-api-secret
          key: admin-password
    - name: APP__INITIAL_ADMIN_USER__NAME
      value: "ScalarFlow Admin"

  # PodSecurityContext holds pod-level security attributes and common container settings.
  podSecurityContext:
    seccompProfile:
      type: RuntimeDefault

  # SecurityContext holds security configuration that will be applied to a container.
  securityContext:
    capabilities:
      drop:
        - ALL
    runAsNonRoot: true
    allowPrivilegeEscalation: false

  # Resource limits
  resources:
    requests:
      cpu: 500m
      memory: 768Mi
    limits:
      cpu: 1500m
      memory: 1536Mi

# Schema Loader configuration
schemaLoader:
  image:
    repository: ghcr.io/scalar-labs/scalarflow-schema-loader
    pullPolicy: IfNotPresent
    tag: ""
  # This will clean the schema loader job after the job is finished
  ttlSecondsAfterFinished: 60
  # Arguments for the scalarflow schema loader
  args: []
  # Environment variables (native Kubernetes env array syntax)
  env:
    - name: SCALARDB_SQL_CONTACT_POINTS
      value: "indirect:scalardb-cluster-envoy"
  # Security context for schema loader (may need elevated permissions)
  podSecurityContext: {}
  securityContext: {}

imagePullSecrets:
  - name: regcred

serviceAccount:
  # -- Specify an existing service account name. If not specified, a new service account will be created.
  serviceAccountName: ""
  # -- Whether to automount the service account token.
  automountServiceAccountToken: false

podAnnotations: {}

# Ingress configuration
# Supports any Kubernetes-compliant ingress controller (nginx, kong, traefik, etc.)
ingress:
  enabled: false
  # Set to your ingress controller class: nginx, kong, traefik, alb, etc.
  className: ""
  # Controller-specific annotations examples:
  # nginx:
  #   nginx.ingress.kubernetes.io/proxy-body-size: "50m"
  #   nginx.ingress.kubernetes.io/ssl-redirect: "true"
  # kong:
  #   konghq.com/strip-path: "false"
  #   konghq.com/protocols: "https"
  #   konghq.com/plugins: "rate-limiting"
  # traefik:
  #   traefik.ingress.kubernetes.io/router.tls: "true"
  # aws-alb:
  #   alb.ingress.kubernetes.io/scheme: internet-facing
  #   alb.ingress.kubernetes.io/target-type: ip
  annotations: {}
  hosts:
    - host: ""
      paths:
        - path: /
          pathType: Prefix
  tls: []

nodeSelector: {}

tolerations: []

affinity: {}
